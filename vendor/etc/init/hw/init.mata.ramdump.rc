on property:debug.sys.crash_dumps=*
   setprop persist.sys.crash_dumps ${debug.sys.crash_dumps}

on property:debug.sys.qxdm_cfg_file=*
   setprop persist.sys.qxdm_cfg_file ${debug.sys.qxdm_cfg_file}

#persist.sys.logging
#where
#    0 = none- ie lock out ports (prod default)
#    1 = on device logging
#    2 = PC logging (handled in diag.rc)

on property:persist.sys.logging=0
   setprop persist.sys.qxdm_logs 0

on property:persist.sys.logging=1
   setprop persist.sys.qxdm_logs 1

on property:persist.sys.logging=2
   setprop persist.sys.qxdm_logs 0

#persist.sys.crash_dumps
#where
#    0 = silent reset (prod default)
#    1 = on device (pipe to sdcard/ramdump)
#    2 = on pc (dump entire image to PC via QPST)

# Default Sub System Restart (SSR) Level
#   SYSTEM: Do host reboot when ssr
#  RELATED: No host reboot when ssr

on property:persist.sys.crash_dumps=0 && property:sys.boot_completed=1
   write /sys/module/msm_poweroff/parameters/download_mode 0
   write /sys/bus/msm_subsys/devices/subsys0/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys1/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys2/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys3/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys4/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys5/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys6/restart_level RELATED
   write /sys/module/subsystem_restart/parameters/enable_ramdumps 0
   stop ssr_ramdump

on property:persist.sys.crash_dumps=1 && property:sys.boot_completed=1
   setprop persist.sys.ssr.restart_level ALL_ENABLE
   write /sys/bus/msm_subsys/devices/subsys0/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys1/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys2/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys3/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys4/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys5/restart_level RELATED
   write /sys/bus/msm_subsys/devices/subsys6/restart_level RELATED
   write /sys/module/subsystem_restart/parameters/enable_ramdumps 1
   start ssr_ramdump

on property:persist.sys.crash_dumps=2 && property:sys.boot_completed=1
   write /sys/module/msm_poweroff/parameters/download_mode 1
   write /sys/bus/msm_subsys/devices/subsys0/restart_level SYSTEM
   write /sys/bus/msm_subsys/devices/subsys1/restart_level SYSTEM
   write /sys/bus/msm_subsys/devices/subsys2/restart_level SYSTEM
   write /sys/bus/msm_subsys/devices/subsys3/restart_level SYSTEM
   write /sys/bus/msm_subsys/devices/subsys4/restart_level SYSTEM
   write /sys/bus/msm_subsys/devices/subsys5/restart_level SYSTEM
   write /sys/bus/msm_subsys/devices/subsys6/restart_level SYSTEM

on property:persist.sys.qxdm_logs=1 && property:sys.boot_completed=1
  start mdlog_start

on property:persist.sys.qxdm_logs=0 && property:sys.boot_completed=1
  start mdlog_stop

#subsystem_ramdump as a SSR restart monitor & ramdump generator
service ssr_ramdump /vendor/bin/subsystem_ramdump 2 0 0
  user root
  group system sdcard_rw
  disabled

on boot
  start ssr_diag

# QXDM logs
# Send mask cleanup to modem at exit.
# Cleanup needs be specified only when starting svc not when killing it

service mdlog_start /vendor/bin/diag_mdlog -f ${persist.sys.qxdm_cfg_file:-/etc/Default_Log_Cfg.cfg} -c
    class late_start
    user system
    group system diag sdcard_rw sdcard_r media_rw oem_2901
    disabled
    oneshot

service mdlog_stop /vendor/bin/diag_mdlog -k
    class late_start
    user system
    group system diag sdcard_rw sdcard_r media_rw oem_2901
    disabled
    oneshot
